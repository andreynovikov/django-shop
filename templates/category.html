{% extends "page_overlapped.html" %}
{% load mptt_tags %}
{% load django_bootstrap_breadcrumbs %}
{% load site %}
{% block title %}{{ category.name }}{% endblock %}
{% block content_title %}{{ category.name }}{% endblock %}
{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb "Каталог" "catalog" %}
    {% for node,structure in category.get_ancestors|tree_info %}
        {% if node.is_child_node %}
            {% breadcrumb node "category" node.get_path %}
        {% endif %}
    {% endfor %}
    {% breadcrumb category.name "" %}
{% endblock %}
{% block content %}

    <!-- Page Content-->
    <div class="container pb-5 mb-2 mb-md-4">
    
    <!-- Toolbar-->
      {% with category.get_children|filter_qs:"active"|filter_qs:"!hidden" as children %}
      <div class="bg-light box-shadow-lg rounded-lg p-4 mt-n5 mb-4">
        <div class="d-flex justify-content-between align-items-center">
        {% if children|length > 0 or category.description %}
          <div class="dropdown mr-2"><a class="btn btn-outline-secondary dropdown-toggle" href="#shop-filters" data-toggle="collapse"><i class="czi-filter mr-2"></i>Отбор</a></div>
        {% endif %}
         <div class="d-flex flex-wrap">
              <div class="form-inline flex-nowrap">
                <label class="opacity-75 text-nowrap mr-2 d-none d-md-block" for="sorting">Sort by:</label>
                <select class="form-control custom-select" id="sorting">
                  <option>Popularity</option>
                  <option>Low - Hight Price</option>
                  <option>High - Low Price</option>
                  <option>Average Rating</option>
                  <option>A - Z Order</option>
                  <option>Z - A Order</option>
                </select><span class="font-size-sm opacity-75 text-nowrap ml-2 d-none d-md-block">of {{ products.paginator.count }} products</span>
              </div>
          </div>
          {% if products.has_other_pages %}
          <div class="d-flex">{% if products.has_previous %}<a class="nav-link-style mr-3" href="?page={{ products.previous_page_number }}"><i class="czi-arrow-left"></i></a>{% endif %}<span class="font-size-md">{{ products.number }} / {{ products.paginator.num_pages }}</span>{% if products.has_next %}<a class="nav-link-style ml-3" href="?page={{ products.next_page_number }}"><i class="czi-arrow-right"></i></a>{% endif %}</div>
          {% endif %}
          <div class="d-none d-sm-flex"><a class="btn btn-icon nav-link-style bg-primary text-light disabled opacity-100 mr-2" href="#"><i class="czi-view-grid"></i></a><a class="btn btn-icon nav-link-style" href="shop-list-ft.html"><i class="czi-view-list"></i></a></div>
        </div>
        <!-- Toolbar with expandable filters-->
        <div class="collapse {% if children|length > 0 or category.description %}show{% endif %}" id="shop-filters">
		  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 pt-4">
		  
          {% if children|length > 0 %}
		  	<div class="{% if category.description %}col-lg-6{% else %}col-lg-8{% endif %} col-md-12 col-sm-12">
          <!-- Categories-->
          {% load partition %}
              <div class="card mb-grid-gutter">
                <div class="card-body px-4">
                  <div class="widget widget-categories">
                    <h3 class="widget-title">Категории</h3>
                    <div class="accordion mt-n1" id="shop-categories">
            {% for row in children|rows_limited:20 %}
              {% for child in row %}
              <div class="card">
                <div class="card-header">
                <div class="row">
                 <div class="col">
                 <h3 class="accordion-heading"><a class="collapsed" href="{% url 'category' child.get_path %}">{{ child.name }}</a></h3>
                 </div>
                 <div class="col-auto pt-2">
                 <h3 class="accordion-heading">{% if child.get_children|filter_qs:"active"|filter_qs:"!hidden"|length %}<a style="width:15px" class="collapsed" href="#cat{{ child.id }}" role="button" data-toggle="collapse" aria-expanded="false" aria-controls="cat{{ child.id }}"><span class="accordion-indicator"></span></a>{% endif %}</h3>
                 </div>
                </div>
                </div>
                {% if child.get_children|filter_qs:"active"|filter_qs:"!hidden"|length %}
                <div class="collapse" id="cat{{ child.id }}" data-parent="#shop-categories">
                          <div class="card-body">
                            <div class="widget widget-links cz-filter">
                              <ul class="widget-list cz-filter-list pt-1" style="height: 12rem;" data-simplebar data-simplebar-auto-hide="false">
                                {% for subcategory in child.get_children|filter_qs:"active"|filter_qs:"!hidden" %}
                                <li class="widget-list-item cz-filter-item"><a class="widget-list-link d-flex justify-content-between align-items-center" href="{% url 'category' subcategory.get_path %}"><span class="cz-filter-item-text">{{ subcategory.name }}</span><span class="font-size-xs text-muted ml-3">1,953</span></a></li>
                                {% endfor %}
                              </ul>
                            </div>
                          </div>
                </div>
                {% endif %}
              </div>
              {% endfor %}
            {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
			  </div>
          {% endif %}

          {% if category.description %}
          	<div class="col-lg-6 col-md-12 col-sm-12">
          <!-- Category description-->
              <div class="card mb-grid-gutter">
                <div class="card-body px-4">
                {{ category.description|safe }}
                </div>
              </div>
            </div>
          {% endif %}	          
				
				<div class="col">
		  <!-- Price range
              <div class="card mb-grid-gutter">
                <div class="card-body px-4">
                  <div class="widget">
                    <h3 class="widget-title">Price range</h3>
                    <div class="cz-range-slider" data-start-min="250" data-start-max="680" data-min="0" data-max="1000" data-step="1">
                      <div class="cz-range-slider-ui"></div>
                      <div class="d-flex pb-1">
                        <div class="w-50 pr-2 mr-2">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend"><span class="input-group-text">$</span></div>
                            <input class="form-control cz-range-slider-value-min" type="text">
                          </div>
                        </div>
                        <div class="w-50 pl-2">
                          <div class="input-group input-group-sm">
                            <div class="input-group-prepend"><span class="input-group-text">$</span></div>
                            <input class="form-control cz-range-slider-value-max" type="text">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
			  -->
				</div>
				<div class="col">
			<!-- Filter by Brand
              <div class="card mb-grid-gutter">
                <div class="card-body px-4">
                  <div class="widget cz-filter">
                    <h3 class="widget-title">Brand</h3>
                    <div class="input-group-overlay input-group-sm mb-2">
                      <input class="cz-filter-search form-control form-control-sm appended-form-control" type="text" placeholder="Search">
                      <div class="input-group-append-overlay"><span class="input-group-text"><i class="czi-search"></i></span></div>
                    </div>
                    <ul class="widget-list cz-filter-list list-unstyled pt-1" style="max-height: 12rem;" data-simplebar data-simplebar-auto-hide="false">
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="adidas">
                          <label class="custom-control-label cz-filter-item-text" for="adidas">Adidas</label>
                        </div><span class="font-size-xs text-muted">425</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="ataylor">
                          <label class="custom-control-label cz-filter-item-text" for="ataylor">Ann Taylor</label>
                        </div><span class="font-size-xs text-muted">15</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="armani">
                          <label class="custom-control-label cz-filter-item-text" for="armani">Armani</label>
                        </div><span class="font-size-xs text-muted">18</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="vsecret">
                          <label class="custom-control-label cz-filter-item-text" for="vsecret">Victoria's Secret</label>
                        </div><span class="font-size-xs text-muted">238</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="wolverine">
                          <label class="custom-control-label cz-filter-item-text" for="wolverine">Wolverine</label>
                        </div><span class="font-size-xs text-muted">29</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="wrangler">
                          <label class="custom-control-label cz-filter-item-text" for="wrangler">Wrangler</label>
                        </div><span class="font-size-xs text-muted">115</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
			  -->
				</div>
				<div class="col">
				<!-- Filter by Size
              <div class="card mb-grid-gutter">
                <div class="card-body px-4">
                  <div class="widget cz-filter">
                    <h3 class="widget-title">Size</h3>
                    <div class="input-group-overlay input-group-sm mb-2">
                      <input class="cz-filter-search form-control form-control-sm appended-form-control" type="text" placeholder="Search">
                      <div class="input-group-append-overlay"><span class="input-group-text"><i class="czi-search"></i></span></div>
                    </div>
                    <ul class="widget-list cz-filter-list list-unstyled pt-1" style="max-height: 12rem;" data-simplebar data-simplebar-auto-hide="false">
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="size-xs">
                          <label class="custom-control-label cz-filter-item-text" for="size-xs">XS</label>
                        </div><span class="font-size-xs text-muted">34</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="size-s">
                          <label class="custom-control-label cz-filter-item-text" for="size-s">S</label>
                        </div><span class="font-size-xs text-muted">57</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="size-m">
                          <label class="custom-control-label cz-filter-item-text" for="size-m">M</label>
                        </div><span class="font-size-xs text-muted">198</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="size-l">
                          <label class="custom-control-label cz-filter-item-text" for="size-l">L</label>
                        </div><span class="font-size-xs text-muted">72</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="size-xl">
                          <label class="custom-control-label cz-filter-item-text" for="size-xl">XL</label>
                        </div><span class="font-size-xs text-muted">46</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="size-39">
                          <label class="custom-control-label cz-filter-item-text" for="size-39">39</label>
                        </div><span class="font-size-xs text-muted">112</span>
                      </li>
                      <li class="cz-filter-item d-flex justify-content-between align-items-center mb-1">
                        <div class="custom-control custom-checkbox">
                          <input class="custom-control-input" type="checkbox" id="size-44">
                          <label class="custom-control-label cz-filter-item-text" for="size-44">44</label>
                        </div><span class="font-size-xs text-muted">61</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
			  -->
			  
			  
				</div>
				<div class="col">
			<!-- Filter by Color
              <div class="card mb-grid-gutter">
                <div class="card-body px-4">
                  <div class="widget">
                    <h3 class="widget-title">Color</h3>
                    <div class="d-flex flex-wrap">
                      <div class="custom-control custom-option text-center mb-2 mx-1" style="width: 4rem;">
                        <input class="custom-control-input" type="checkbox" id="color-blue-gray">
                        <label class="custom-option-label rounded-circle" for="color-blue-gray"><span class="custom-option-color rounded-circle" style="background-color: #b3c8db;"></span></label>
                        <label class="d-block font-size-xs text-muted mt-n1" for="color-blue-gray">Blue-gray</label>
                      </div>
                      <div class="custom-control custom-option text-center mb-2 mx-1" style="width: 4rem;">
                        <input class="custom-control-input" type="checkbox" id="color-burgundy">
                        <label class="custom-option-label rounded-circle" for="color-burgundy"><span class="custom-option-color rounded-circle" style="background-color: #ca7295;"></span></label>
                        <label class="d-block font-size-xs text-muted mt-n1" for="color-burgundy">Burgundy</label>
                      </div>
                      <div class="custom-control custom-option text-center mb-2 mx-1" style="width: 4rem;">
                        <input class="custom-control-input" type="checkbox" id="color-teal">
                        <label class="custom-option-label rounded-circle" for="color-teal"><span class="custom-option-color rounded-circle" style="background-color: #91c2c3;"></span></label>
                        <label class="d-block font-size-xs text-muted mt-n1" for="color-teal">Teal</label>
                      </div>
                      <div class="custom-control custom-option text-center mb-2 mx-1" style="width: 4rem;">
                        <input class="custom-control-input" type="checkbox" id="color-brown">
                        <label class="custom-option-label rounded-circle" for="color-brown"><span class="custom-option-color rounded-circle" style="background-color: #9a8480;"></span></label>
                        <label class="d-block font-size-xs text-muted mt-n1" for="color-brown">Brown</label>
                      </div>
                      <div class="custom-control custom-option text-center mb-2 mx-1" style="width: 4rem;">
                        <input class="custom-control-input" type="checkbox" id="color-coral-red">
                        <label class="custom-option-label rounded-circle" for="color-coral-red"><span class="custom-option-color rounded-circle" style="background-color: #ff7072;"></span></label>
                        <label class="d-block font-size-xs text-muted mt-n1" for="color-coral-red">Coral red</label>
                      </div>
                      <div class="custom-control custom-option text-center mb-2 mx-1" style="width: 4rem;">
                        <input class="custom-control-input" type="checkbox" id="color-navy">
                        <label class="custom-option-label rounded-circle" for="color-navy"><span class="custom-option-color rounded-circle" style="background-color: #696dc8;"></span></label>
                        <label class="d-block font-size-xs text-muted mt-n1" for="color-navy">Navy</label>
                      </div>
                      <div class="custom-control custom-option text-center mb-2 mx-1" style="width: 4rem;">
                        <input class="custom-control-input" type="checkbox" id="color-charcoal">
                        <label class="custom-option-label rounded-circle" for="color-charcoal"><span class="custom-option-color rounded-circle" style="background-color: #4e4d4d;"></span></label>
                        <label class="d-block font-size-xs text-muted mt-n1" for="color-charcoal">Charcoal</label>
                      </div>
                      <div class="custom-control custom-option text-center mb-2 mx-1" style="width: 4rem;">
                        <input class="custom-control-input" type="checkbox" id="color-sky-blue">
                        <label class="custom-option-label rounded-circle" for="color-sky-blue"><span class="custom-option-color rounded-circle" style="background-color: #8bcdf5;"></span></label>
                        <label class="d-block font-size-xs text-muted mt-n1" for="color-sky-blue">Sky blue</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
			  -->
			  
				</div>
			</div>
		  
        </div>
      </div>
      {% endwith %}
    
        <!-- Content  -->
          <!-- Products grid-->
          <div class="row pt-3 mx-n2">
            {% for product in products %}
            <!-- Product-->
            <div class="col-lg-3 col-md-4 col-sm-6 px-2 mb-4">
              {% include "_product_info.html" %}
              <hr class="d-sm-none">
            </div>
            {% endfor %}
          </div>
          {% if products.has_other_pages %}
          <hr class="my-3">
          <!-- Pagination-->
          <nav class="d-flex justify-content-between pt-2" aria-label="Переключение страниц">

            <ul class="pagination">
            {% if products.has_previous %}
              <li class="page-item"><a class="page-link" href="?page={{ products.previous_page_number }}"><i class="czi-arrow-left mr-2"></i>Пред<span class="d-none d-sm-inline d-md-none d-xl-inline">ыдущая</span></a></li>
            {% endif %}
            </ul>
            <ul class="pagination">
              {% for page in products.paginator.page_range %}
              {% if page == products.number %}
              <li class="page-item d-md-none"><span class="page-link page-link-static">{{ products.number }} / {{ products.paginator.num_pages }}</span></li>
              <li class="page-item active d-none d-md-block" aria-current="page"><span class="page-link">{{ products.number }}<span class="sr-only">(текущая)</span></span></li>
              {% elif page >= min_page and page <= max_page or page == 1 or page == products.paginator.num_pages %}
              {% if max_page < products.paginator.num_pages and page == products.paginator.num_pages %}
              <li class="page-item d-none d-md-block">&hellip;</li>
              {% endif %}
              <li class="page-item d-none d-md-block"><a class="page-link" href="?page={{ page }}">{{ page }}</a></li>
              {% if min_page > 1 and page == 1 %}
              <li class="page-item d-none d-md-block">&hellip;</li>
              {% endif %}
              {% endif %}
              {% endfor %}
            </ul>

            <ul class="pagination">
            {% if products.has_next %}
              <li class="page-item"><a class="page-link" href="?page={{ products.next_page_number }}">След<span class="d-none d-sm-inline d-md-none d-xl-inline">ующая</span><i class="czi-arrow-right ml-2"></i></a></li>
            {% endif %}
            </ul>

            </nav>
          {% endif %}

    </div>
{% endblock content %}
