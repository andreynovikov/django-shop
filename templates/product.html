{% extends "base.html" %}
{% load staticfiles %}
{% load site %}
{% load decimals %}
{% load render_as_template %}
{% load shop_filters %}
{% load mptt_tags %}
{% load django_bootstrap_breadcrumbs %}
{% block title %}{{ product.title }}{% endblock %}
{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb "К первой странице" "/" %}
    
    {% if product.breadcrumbs %}
    {% for node,structure in product.breadcrumbs|tree_info %}
        {% if node.is_child_node %}
            {% breadcrumb node "category" node.get_path %}
        {% endif %}
    {% endfor %}
    {% endif %}
{% endblock %}
{% block head %}
  <!-- Подключение к API виджетов -->
  <script async src="https://widgets.delivery.yandex.ru/script/api"></script>

  <!-- Код виджета -->
  <script>
    (function(w) {
      function startWidget() {
        document.removeEventListener('YaDeliveryLoad', startWidget);
        w.YaDelivery.createWidget({
          containerId: 'myWidget', // Идентификатор HTML-элемента (контейнера), 
                                   // в котором будет отображаться виджет 
          type: 'deliveryInfo',    // Тип виджета — всегда deliveryInfo
          params: {
            apiKey: '01234567-89ab-cdef-f0f0-fedc-ba9876543210', // Авторизационный ключ
            senderId: 456,            // Идентификатор магазина в системе Яндекс.Доставки
            dimensions: {
              width: 10, // Ширина упаковки с товаром в см
              height: 10, // Высота упаковки с товаром в см
              length: 10, // Длина упаковки с товаром в см
              weight: 1,  // Вес упаковки с товаров в кг
            },
            postalCode: 123456,  // Почтовый индекс, чтобы отобразились условия доставки почтой
            themeId: 1,  // Вид отображения виджета — всегда 1
            deliveryTypes: ['COURIER', 'PICKUP', 'POST'] // Доступные способы доставки заказа
                                                         // (курьером, в пункт выдачи, на почту)
          },
        });
      }
      w.YaDelivery
        ? startWidget()
        : document.addEventListener('YaDeliveryLoad', startWidget);
    })(window);
  </script>  
{% endblock %}
{% block content %}

<div itemscope itemtype="http://schema.org/Product">
<section class="product-details">
      <div class="container">
        <div class="row">
          <div class="col-lg-7 order-2 order-lg-1">
            <div class="row">   
              <div class="col-12 detail-carousel">
                {% if product.ishot %}
				<div class="ribbon ribbon-info">Акция</div>
				{% endif %}
				{% if product.isnew %}
				<div class="ribbon ribbon-danger">Новинка</div>
				{% endif %}
				{% if product.recomended %}
				<div class="ribbon ribbon-primary">Рекомендуем</div>
				{% endif %}
                <div class="owl-carousel detail-slider owl-theme owl-dots-modern" data-slider-id="1">
					<div class="item"><a href="{{ MEDIA_URL }}{{ product.image_prefix }}{% if product.image_prefix|add:'.b.jpg'|file_exists %}.b{% endif %}.jpg" data-footer="{{ product.title }} {{ forloop.counter }}" data-toggle="lightbox" data-gallery="product-gallery"><img src="{{ MEDIA_URL }}{{ product.image_prefix }}.jpg" alt="{{ product.title }} {{ product.whatis }}" itemprop="image" class="img-fluid" /></a></div>
					{% if product.images %}
					{% for image in product.images %}
					<div class="item"><a href="{{ MEDIA_URL }}{{ product.image_prefix }}/{{image}}.jpg" data-footer="{{ product.title }} {{ forloop.counter }}" data-toggle="lightbox" data-gallery="product-gallery"><img class="img-fluid" src="{{ MEDIA_URL }}{{ product.image_prefix }}/{{image}}.jpg" alt="{{ product.title }} - {{ forloop.counter }}" /></a></div>
					{% endfor %}
					{% endif %}
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-5 pl-lg-4 order-1 order-lg-2">
            <h1 class="mb-4" itemprop="name">{{ product.title }}</h1>
            <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
			<div class="d-flex flex-column flex-sm-row align-items-sm-center justify-content-sm-between mb-4">
              <ul class="list-inline mb-2 mb-sm-0">
                <li class="list-inline-item h4 font-weight-light mb-0">{{ product.cost|quantize:"1" }}&nbsp;руб.<span itemprop="priceCurrency" style="visibility:hidden;font-size:1pt;margin:0;padding:0;width:0;height:0;line-height:0;">RUB</span></li>
                {% if product.discount > 0 %}<li class="list-inline-item text-muted font-weight-light"><del><span itemprop="price">{{ product.price|quantize:"1" }}</span>&nbsp;руб.</del></li>{% endif %}
              </ul>
			  
              <div class="d-flex align-items-center">
                <ul class="list-inline mr-2 mb-0">
                  <li class="list-inline-item mr-0"><i class="fa fa-star text-primary"></i></li>
                  <li class="list-inline-item mr-0"><i class="fa fa-star text-primary"></i></li>
                  <li class="list-inline-item mr-0"><i class="fa fa-star text-primary"></i></li>
                  <li class="list-inline-item mr-0"><i class="fa fa-star text-primary"></i></li>
                  <li class="list-inline-item mr-0"><i class="fa fa-star text-gray-300"></i></li>
                </ul><span class="text-muted text-uppercase text-sm">25 reviews</span>
              </div>
            </div>
			</div>
			{% if product.partnumber %}
			<p class="mb-4 text-muted">Код производителя: {{ product.partnumber }}</p>
			{% endif %}
			{% if product.runame or product.whatis %}
			<p class="mb-4 text-muted">{{ product.whatis }} {{ product.runame }}</p>
			{% endif %}
			  {% if product.enabled %}
			  {% if product.instock > 1 %}
			<p class="mb-4 text-success">Есть в наличии в интернет-магазине</p>
			  {% endif %}
			  {% endif %}
              <ul class="list-inline">
			  {% if product.enabled %}
				{% if product.instock > 0 %}
				<li class="list-inline-item"><a href="{% url 'shop:add' product.id %}" class="btn btn-success mb-1" type="submit"> <i class="fa fa-shopping-cart mr-2"></i>Купить</a></li>
				{% else %}
				<li class="list-inline-item"><a href="{% url 'shop:add' product.id %}" class="btn btn-success mb-1" type="submit"> <i class="fa fa-shopping-cart mr-2"></i>Сообщить о поступлении</a></li>
				{% endif %}
			  {% endif %}
                <li class="list-inline-item"><a class="btn btn-outline-secondary mb-1" href=""> <i class="far fa-heart mr-2"></i>Сравнить</a></li>
              </ul>
          </div>
        </div>
		<div class="row">
		<div class="col float-start">
                <div class="owl-thumbs" data-slider-id="1">
				{% if product.images %}
				<button class="owl-thumb-item detail-thumb-item mb-3" style="display:inline;"><img class="img-fluid" style="max-height:80px;" src="{{ MEDIA_URL }}{{ product.image_prefix }}.jpg" alt="{{ product.title }} - {{ forloop.counter }}" /></button>
				{% for image in product.images %}
				<button class="owl-thumb-item detail-thumb-item mb-3" style="display:inline;"><img class="img-fluid" style="max-height:80px;" src="{{ MEDIA_URL }}{{ product.image_prefix }}/{{image}}.jpg" alt="{{ product.title }} - {{ forloop.counter }}" /></button>
				{% endfor %}
				{% endif %}
                </div>
              </div>
		</div>
      </div>
    </section>
    <section class="mt-5">
      <div class="container">
	  <div class="tab-content py-4">
        <ul class="nav nav-tabs flex-column flex-sm-row" role="tablist">
		{% if product.descr %}
          <li class="nav-item"><a class="nav-link detail-nav-link active" data-toggle="tab" href="#description_tab" role="tab">Описание</a></li>
		{% endif %}
		{% if product.manuals %}
          <li class="nav-item"><a class="nav-link detail-nav-link" data-toggle="tab" href="#manuals_tab" role="tab">Инструкция</a></li>
		{% endif %}
		{% if product.complect %}
          <li class="nav-item"><a class="nav-link detail-nav-link" data-toggle="tab" href="#complect_tab" role="tab">Комплектация</a></li>
		{% endif %}
		{% if 'images/'|add:product.manufacturer.code|add:'/stitches/'|add:product.code|add:'_stitches.jpg'|file_exists or product.stitches %}
          <li class="nav-item"><a class="nav-link detail-nav-link" data-toggle="tab" href="#stitches_tab" role="tab">Строчки</a></li>
		{% endif %}
		{% if product.country %}
          <li class="nav-item"><a class="nav-link detail-nav-link" data-toggle="tab" href="#specification_tab" role="tab">Технические характеристики</a></li>
		{% endif %}
			
          <li class="nav-item"><a class="nav-link detail-nav-link" data-toggle="tab" href="#reviews_tab" role="tab">Reviews</a></li>
        </ul>

		{% if product.descr %}
	    <div class="tab-pane active px-3 py-4 active" id="description_tab" role="tabpanel" itemprop="description">
		<div class="container">
        {{ product.descr|safe }}
{% if product.spec %}
		{{ product.spec|safe }}
{% endif %}
        </div>
		</div>
		{% endif %}

		{% if product.manuals %}
	    <div class="tab-pane px-3 py-4" id="manuals_tab" role="tabpanel">
        {{ product.manuals|safe }}
        </div>
		{% endif %}
		
		{% if product.complect %}
		<div class="tab-pane px-3 py-4" id="complect_tab" role="tabpanel">
		{{ product.complect|safe }}
        </div>
		{% endif %}
		
		{% if 'images/'|add:product.manufacturer.code|add:'/stitches/'|add:product.code|add:'_stitches.jpg'|file_exists or product.stitches %}
		<div class="tab-pane px-3 py-4" id="stitches_tab" role="tabpanel">
		{% if 'images/'|add:product.manufacturer.code|add:'/stitches/'|add:product.code|add:'_stitches.jpg'|file_exists %}
		<p><img src="{{ MEDIA_URL }}/images/{{ product.manufacturer.code }}/stitches/{{ product.code }}_stitches.jpg" alt="Строчки швейной машины {{ product.title }}" class="img-responsive"></p>
		{% endif %}
		{% if product.stitches %}
		{{ product.stitches|safe }}
		{% endif %}
		</div>
		{% endif %}

		{% if product.country %}
		<div class="tab-pane px-3 py-4" id="specification_tab" role="tabpanel">		
		<dl class="product-spec">
		{% with 'km_class km_font km_needles km_prog km_rapport sw_hoopsize sw_datalink sm_software sm_shuttletype sm_stitchwidth sm_stitchlenght sm_maxi sm_stitchquantity sm_buttonhole sm_alphabet sm_dualtransporter sm_platformlenght sm_freearm sm_feedwidth sm_footheight sm_constant sm_speedcontrol sm_needleupdown sm_threader sm_autocutter sm_spool sm_presscontrol sm_power sm_light sm_organizer sm_autostop sm_ruler sm_wastebin sm_cover sm_display sm_advisor sm_memory sm_mirror sm_startstop sm_kneelift sm_diffeed sm_easythreading ov_freearm sm_needles developer_country country warranty prom_transporter_type prom_shuttle_type prom_speed prom_needle_type prom_stitch_lenght prom_foot_lift prom_fabric_type prom_oil_type weight prom_weight prom_cutting prom_threads_num prom_power prom_bhlenght prom_overstitch_lenght prom_overstitch_width prom_stitch_width prom_needle_width prom_needle_num prom_platform_type prom_button_diaouter prom_button_diainner prom_needle_height prom_stitch_type prom_autothread' as field_list %}
		{% for field in field_list.split %}
		{% if field == 'developer_country' and product.developer_country.enabled or field == 'country' and product.country.enabled or field != 'developer_country' and field != 'country' %}
		{% with field_value=product|get_field:field %}
		{% if field_value %}
		{% with field_name=product|get_field_name:field|parse_field_name %}
		<dt><span>{{ field_name.0 }}{% include '_field_help.html' %}</span></dt><dd>{{ field_value|prettify }}{{ field_name.1 }}</dd>
		{% endwith %}
		{% endif %}
		{% endwith %}
		{% endif %}
		{% endfor %}
		{% endwith %}
		</dl>
		</div>
		{% endif %}

          <div class="tab-pane" id="reviews_tab" role="tabpanel">
            <div class="row mb-5">
              <div class="col-lg-10 col-xl-9">
                <div class="media review">
                  <div class="text-center mr-4 mr-xl-5"><img class="review-image" src="img/person-1.jpg" alt="Han Solo"><span class="text-uppercase text-muted">Dec 2018</span></div>
                  <div class="media-body">
                    <h5 class="mt-2 mb-1">Han Solo</h5>
                    <div class="mb-2"><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i>
                    </div>
                    <p class="text-muted">One morning, when Gregor Samsa woke from troubled dreams, he found himself transformed in his bed into a horrible vermin. He lay on his armour-like back, and if he lifted his head a little he could see his brown belly, slightly domed and divided by arches into stiff sections     </p>
                  </div>
                </div>
                <div class="media review">
                  <div class="text-center mr-4 mr-xl-5"><img class="review-image" src="img/person-2.jpg" alt="Luke Skywalker"><span class="text-uppercase text-muted">Dec 2018</span></div>
                  <div class="media-body">
                    <h5 class="mt-2 mb-1">Luke Skywalker</h5>
                    <div class="mb-2"><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-gray-200"></i>
                    </div>
                    <p class="text-muted">The bedding was hardly able to cover it and seemed ready to slide off any moment. His many legs, pitifully thin compared with the size of the rest of him, waved about helplessly as he looked. &quot;What's happened to me?&quot; he thought. It wasn't a dream.     </p>
                  </div>
                </div>
                <div class="media review">
                  <div class="text-center mr-4 mr-xl-5"><img class="review-image" src="img/person-3.jpg" alt="Princess Leia"><span class="text-uppercase text-muted">Dec 2018</span></div>
                  <div class="media-body">
                    <h5 class="mt-2 mb-1">Princess Leia</h5>
                    <div class="mb-2"><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-gray-200"></i><i class="fa fa-xs fa-star text-gray-200"></i>
                    </div>
                    <p class="text-muted">His room, a proper human room although a little too small, lay peacefully between its four familiar walls. A collection of textile samples lay spread out on the table.     </p>
                  </div>
                </div>
                <div class="media review">
                  <div class="text-center mr-4 mr-xl-5"><img class="review-image" src="img/person-4.jpg" alt="Jabba Hut"><span class="text-uppercase text-muted">Dec 2018</span></div>
                  <div class="media-body">
                    <h5 class="mt-2 mb-1">Jabba Hut</h5>
                    <div class="mb-2"><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i><i class="fa fa-xs fa-star text-warning"></i>
                    </div>
                    <p class="text-muted">Samsa was a travelling salesman - and above it there hung a picture that he had recently cut out of an illustrated magazine and housed in a nice, gilded frame.     </p>
                  </div>
                </div>
                <div class="py-5 px-3">
                  <h5 class="text-uppercase mb-4">Leave a review</h5>
                  <form class="form" id="contact-form" method="post" action="contact.php">
                    <div class="row">
                      <div class="col-sm-6">
                        <div class="form-group">
                          <label class="form-label" for="name">Your name *</label>
                          <input class="form-control" type="text" name="name" id="name" placeholder="Enter your name" required="required">
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="form-group">
                          <label class="form-label" for="rating">Your rating *</label>
                          <select class="custom-select focus-shadow-0" name="rating" id="rating">
                            <option value="5">&#9733;&#9733;&#9733;&#9733;&#9733; (5/5)</option>
                            <option value="4">&#9733;&#9733;&#9733;&#9733;&#9734; (4/5)</option>
                            <option value="3">&#9733;&#9733;&#9733;&#9734;&#9734; (3/5)</option>
                            <option value="2">&#9733;&#9733;&#9734;&#9734;&#9734; (2/5)</option>
                            <option value="1">&#9733;&#9734;&#9734;&#9734;&#9734; (1/5)</option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label" for="email">Your email *</label>
                      <input class="form-control" type="email" name="email" id="email" placeholder="Enter your  email" required="required">
                    </div>
                    <div class="form-group">
                      <label class="form-label" for="review">Review text *</label>
                      <textarea class="form-control" rows="4" name="review" id="review" placeholder="Enter your review" required="required"></textarea>
                    </div>
                    <button class="btn btn-outline-dark" type="submit">Post review</button>
                  </form>
                </div>
              </div>
            </div>
          </div>

	  </div>
	  </div>

    </section>  
</div>
<!--- /product-page --->
{% endblock %}
