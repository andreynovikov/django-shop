{% extends "base.html" %}
{% load static %}
{% load site %}
{% load decimals %}
{% load shop_filters %}
{% load mptt_tags %}
{% load django_bootstrap_breadcrumbs %}
{% block title %}
<title>{{ product.title }}</title>
{% endblock %}
{% block css %}
<style type="text/css">
.product-page          { max-width:1000px; margin: 0 auto; }
.product-page h2       { font-size:1.4em; border-bottom:1px solid #e0e0e0; padding-bottom:5px; margin-top:40px; margin-bottom:20px; }
.product-buyblock      { float:none; display:inline-block; vertical-align:top;}
@media(max-width:768px){
.product-buyblock      { width:100%; }
.product-buyblock-body { max-width:320px; text-align:center;}
.product-image         { width:100%; }
.product-image .popup-gallery { max-width:600px; margin: 0 auto; text-align:center;}
}
@media(min-width:768px){
.product-buyblock      { max-width:380px; }
}
.panel-body {padding:3px;padding-top:10px;}
.product-image        { float:none; display:inline-block; vertical-align:top; }
.product-nal-caption  { font-weight:bold; }
.product-nal-true     { color:#4cae4c; font-weight:bold; }
.product-nal-false    { color:#aaaaaa; font-weight:bold; }
.product-delivery-caption { font-weight:bold; }
.product-salesnotes, .product-gift  { color:@brand-orange; }
.price                { font-size:1.2em; font-weight:bold; }
.price span           { color:@brand-orange; font-size:1.4em; }
.oldprice             { text-decoration:line-through; }
.product-spec         { display: block; position:relative; margin:0; }
.product-spec dt      { display: inline-block; width: 49%; margin: 0 0 7px; vertical-align: top;}
.product-spec dd      { display: inline-block; width: 50%; margin: 0 0 7px; vertical-align: bottom; background: inherit; }
.product-spec dt span { font-weight:normal; }
.product-spec dt:after { position: absolute; content:"";  }

.modelProperties td	{padding-right:0;padding-bottom:0;padding-left:0;vertical-align: bottom;}
.modelProperties td.sw-label	{padding-right:10;padding-bottom:0;padding-left:0;line-height:1.2em;}
.modelProperties span	{background-color:white;}


/* для подсказки */
.opener img, .opener-ajax img, .opener-html img { opacity: 0.5; width: 14px; height: 14px; border:0; border-spacing:0; }
.white-popup-block            {background: white;padding: 20px 30px;text-align: left;max-width: 800px;margin: 40px auto;position: relative;}
.white-popup-block img        {margin:10px}
.popup-gallery                { margin-top:5px; }

.price .sw-addProduct-sm      { margin-bottom:5px; }
.sw-addProduct-sm     { font-weight:bold; text-decoration:none; }
</style>
{% endblock %}





{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb "К первой странице" "/" %}
    {% breadcrumb "Каталог" "catalog" %}
    {% if product.breadcrumbs %}
    {% for node,structure in product.breadcrumbs|tree_info %}
        {% if node.is_child_node %}
            {% breadcrumb node "category" node.get_path %}
        {% endif %}
    {% endfor %}
    {% endif %}
{% endblock %}
{% block content %}
<div class="products">
<div itemscope itemtype="http://schema.org/Product">
<h1 itemprop="name">{{ product.title }}
<sup>
{% if product.ishot %}
<span class="label label-warning">Акция</span>
{% endif %}
{% if product.isnew %}
<span class="label label-danger">Новинка</span>
{% endif %}
{% if product.recomended %}
<span class="label label-success">Рекомендуем</span>
{% endif %}
</sup>
</h1>

{% if product.partnumber %}
<p>Код производителя: {{ product.partnumber }}</p>
{% endif %}
{% if product.runame or product.whatis %}
<p>{{ product.whatis }} {{ product.runame }}</p>
{% endif %}


<div class="product-image">
{% if product.image_prefix|add:'.jpg'|file_exists %}
{% if product.image_prefix|add:'.b.jpg'|file_exists %}
<div class="popup-gallery"><a href="{{ MEDIA_URL }}{{ product.image_prefix }}.b.jpg">
{% endif %}
<img  style="max-width:540px; height:auto;" id="{{ product.id }}" src="{{ MEDIA_URL }}{{ product.image_prefix }}.jpg" alt="{{ product.title }} {{ product.whatis }}" itemprop="image"  class="img-responsive"/>
{% if product.image_prefix|add:'.b.jpg'|file_exists %}
</a></div>
{% endif %}
{% endif %}
</div>

<div class="panel panel-default product-buyblock">
<div class="panel-body product-buyblock-body">
{% if product.enabled %}
<div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
{% if product.discount > 0 %}
<p class="oldprice">{{ product.price|quantize:"1" }}&nbsp;руб. <a href="#dialog_discount" class="opener"><img src="{% static 'i/icons/more_icon.png' %}"></a></p>
{% endif %}
<p class="price"><span itemprop="price">{{ product.cost|quantize:"1" }}</span>&nbsp;руб.

{% if product.instock > 0 %}
<a href="{% url 'shop:add' product.id %}"
class="addProduct btn btn-success sw-addProduct-sm" role="button" id="p_{{ product.id }}">Купить</a>
{% else %}
<a href="{% url 'shop:add' product.id %}"
class="addProduct btn btn-success sw-addProduct-sm" role="button" id="p_{{ product.id }}">Сообщить о поступлении</a>
{% endif %}

<span itemprop="priceCurrency" style="visibility:hidden;font-size:1pt;margin:0;padding:0;width:0;height:0;line-height:0;">RUB</span>
</p>
{% if product.available %}
<p><span class="product-nal-caption">Наличие:</span>
{% if product.instock > 1 %}
<span class="product-nal-true">Есть</span>
{% endif %}
{% if product.instock == 1 %}
<span class="product-nal-true">Мало</span>
{% endif %}
{% if product.instock < 1 %}
<span class="product-nal-false">Нет</span>
{% endif %}
</p>
{% endif %}
{% if sales_notes %}
<p class="product-salesnotes">{{ sales_notes }}</p>
{% endif %}
{% if product.instock > 1 %}
<meta name="ydWidgetData" id="e87ab1a4b521b363e68df04de4866de4" content="" data-sender_id="15938" data-weight="10" data-cost="{{ product.cost }}" data-height="27" data-length="50" data-width="40" data-city_from="Москва" data-geo_id_from="213" data-css_name="geo_tpl" data-tpl_name="geo_tpl" data-container_tag_id="b1a118f6e3252a711b9146c1d41567e5" data-resource_id="21272" data-resource_key="1780931b94c77b42c08b895fb88747d2" data-tracking_method_key="43df8cf1b0d40baaef3a3363458314f1" data-autocomplete_method_key="fd34c231b276f9bea3db9b60ac09506e"></meta><!--[if lt IE 9]><script>document.createElement("msw");</script><![endif]-->
<script src="https://delivery.yandex.ru/widget/widgetJsLoader?dataTagID=e87ab1a4b521b363e68df04de4866de4" charset="utf-8"></script>
<msw id="b1a118f6e3252a711b9146c1d41567e5" class="yd-widget-container"></msw>
{% endif %}
</div>
{% else %}
<span class="product-nal-false">Товар снят с продажи</span>
{% endif %}{# enabled #}
</div>
</div>

{% if product.images %}
<div class="popup-gallery">
{% for image in product.images %}
<a href="{{ MEDIA_URL }}{{ product.image_prefix }}/{{image}}.jpg"><img src="{{ MEDIA_URL }}{{ product.image_prefix }}/{{image}}.s.jpg" alt="{{ product.title }} - Фото №{{ forloop.counter }}" border="0" /></a>
{% endfor %}
</div>
{% endif %}

{% if constituents %}
<h2>Состав комплекта:</h2>
<table style="margin-bottom: 10pt">
{% for item in constituents %}
{% with item.constituent as product %}
<tr><td>{% if product.image_prefix|add:'.s.jpg'|file_exists %}
<img src="{{ MEDIA_URL }}{{ product.image_prefix }}.s.jpg" alt="{{ product.title }} {{ product.whatis }}" />
{% endif %}</td>
<td style="padding-left: 6pt">
<h3 class="sw-p-l-name-h"><a href="{% url 'product' product.code %}">{{ product.title }}</a>{% if item.quantity > 1 %} ({{ item.quantity }} шт.){% endif %}</h3>
<div class="sw-p-l-brif">
{{ product.shortdescr|safe }}
</div>
</td></tr>
<script>
gtm_products.push({'name':'{{ product.title }}','id':'{{ product.id }}','price':'{{ product.price }}','brand':'{{ product.manufacturer.code }}','list':'Состав комплекта','position':{{ forloop.counter }}});
</script>
{% endwith %}
{% endfor %}
</table>
{% endif %}

{% if product.descr %}
<p itemprop="description">{{ product.descr|safe }}</p>
{% endif %}
{% if product.spec %}
<p>{{ product.spec|safe }}</p>
{% endif %}

{% if product.manuals %}
<h2>Инструкции для {{ product.title }}:</h2>
{{ product.manuals|safe }}
{% endif %}

{% if product.warranty %}
<h2>Характеристики {{ product.title }}:</h2>
{% endif %}

<dl class="product-spec">
{% if product.fabric_verylite %}
<dt><span>Диапазон прошиваемых материалов <a class="opener-html" href="/blog/H/"><img src="{% static 'i/icons/more_icon.png' %}"></a></span></dt><dd>Очень легкие – {{ product.fabric_verylite }}<br>Легкие – {{ product.fabric_lite }}<br>Средние и умеренно тяжелые – {{ product.fabric_medium }}<br>Тяжелые – {{ product.fabric_hard }}<br>Трикотаж – {{ product.fabric_stretch }}</dd>
{% endif %}
{% with 'km_class km_font km_needles km_prog km_rapport sw_hoopsize sw_datalink sm_software sm_shuttletype sm_stitchwidth sm_stitchlenght sm_maxi sm_stitchquantity sm_buttonhole sm_alphabet sm_dualtransporter sm_platformlenght sm_freearm sm_feedwidth sm_footheight sm_constant sm_speedcontrol sm_needleupdown sm_threader sm_autocutter sm_spool sm_presscontrol sm_power sm_light sm_organizer sm_autostop sm_ruler sm_wastebin sm_cover sm_display sm_advisor sm_memory sm_mirror sm_startstop sm_kneelift sm_diffeed sm_easythreading ov_freearm sm_needles developer_country country warranty prom_transporter_type prom_shuttle_type prom_speed prom_needle_type prom_stitch_lenght prom_foot_lift prom_fabric_type prom_oil_type weight prom_weight prom_cutting prom_threads_num prom_power prom_bhlenght prom_overstitch_lenght prom_overstitch_width prom_stitch_width prom_needle_width prom_needle_num prom_platform_type prom_button_diaouter prom_button_diainner prom_needle_height prom_stitch_type prom_autothread' as field_list %}
{% for field in field_list.split %}
{% if field == 'developer_country' and product.developer_country.enabled or field == 'country' and product.country.enabled or field != 'developer_country' and field != 'country' %}
{% with field_value=product|get_field:field %}
{% if field_value %}
{% with field_name=product|get_field_name:field|parse_field_name %}
<dt><span>{{ field_name.0 }}{% include '_field_help.html' %}</span></dt><dd>{{ field_value|prettify }}{{ field_name.1 }}</dd>
{% endwith %}
{% endif %}
{% endwith %}
{% endif %}
{% endfor %}
{% endwith %}
</dl>

{% if 'images/'|add:product.manufacturer.code|add:'/stitches/'|add:product.code|add:'_stitches.jpg'|file_exists or product.stitches %}
<h2>Строчки {{ product.title }}:</h2>
{% if 'images/'|add:product.manufacturer.code|add:'/stitches/'|add:product.code|add:'_stitches.jpg'|file_exists %}
<p><img src="{{ MEDIA_URL }}/images/{{ product.manufacturer.code }}/stitches/{{ product.code }}_stitches.jpg" alt="Строчки швейной машины {{ product.title }}" class="img-responsive"></p>
{% endif %}
{% if product.stitches %}
{{ product.stitches|safe }}
{% endif %}
{% endif %}


{% if product.complect %}
<h2>Комплектация</h2>
<p>{{ product.complect|safe }}</p>
{% endif %}

</div>

</div> <!--- /product-page --->
{% endblock %}
