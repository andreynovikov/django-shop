{% extends "base.html" %}
{% load static %}
{% load site %}
{% load decimals %}
{% load render_as_template %}
{% load shop_filters %}
{% load mptt_tags %}
{% load reviews %}
{% load django_bootstrap_breadcrumbs %}
{% block title %}{{ product.title }}{% endblock %}
{% block css %}
<link rel="stylesheet" href="{% static 'reviews/css/reviews.css' %}"/>
<link rel="stylesheet" href="{% static 'reviews/css/star-rating.css' %}"/>
<style>
.gl-star-rating-stars > span {
  width: 18px; height: 18px; background-size: 18px; margin: 0 0 0 0;
}
</style>
{% endblock %}
{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb "К первой странице" "/" %}
    
    {% if product.breadcrumbs %}
    {% for node,structure in product.breadcrumbs|tree_info %}
        {% if node.is_child_node %}
            {% breadcrumb node "category" node.get_path %}
        {% endif %}
    {% endfor %}
    {% endif %}
{% endblock %}
{% block head %}
{% endblock %}
{% block content %}

<div itemscope itemtype="http://schema.org/Product">
<section class="product-details">
      <div class="container">
        <div class="row">
          <div class="col-lg-7 order-2 order-lg-1">
            <div class="row">   
              <div class="col-12 detail-carousel">
                {% if product.ishot %}
				<div class="ribbon ribbon-info">Акция</div>
				{% endif %}
				{% if product.isnew %}
				<div class="ribbon ribbon-danger">Новинка</div>
				{% endif %}
				{% if product.recomended %}
				<div class="ribbon ribbon-primary">Рекомендуем</div>
				{% endif %}
                <div class="owl-carousel detail-slider owl-theme owl-dots-modern" data-slider-id="1">
					<div class="item"><a href="{{ MEDIA_URL }}{{ product.image_prefix }}{% if product.image_prefix|add:'.b.jpg'|file_exists %}.b{% endif %}.jpg" data-footer="{{ product.title }} {{ forloop.counter }}" data-toggle="lightbox" data-gallery="product-gallery"><img src="{{ MEDIA_URL }}{{ product.image_prefix }}.jpg" alt="{{ product.title }} {{ product.whatis }}" itemprop="image" class="img-fluid" style="max-height:500px; width:auto;"/></a></div>
					{% if product.images %}
					{% for image in product.images %}
					<div class="item"><a href="{{ MEDIA_URL }}{{ product.image_prefix }}/{{image}}.jpg" data-footer="{{ product.title }} {{ forloop.counter }}" data-toggle="lightbox" data-gallery="product-gallery"><img class="img-fluid" src="{{ MEDIA_URL }}{{ product.image_prefix }}/{{image}}.jpg" alt="{{ product.title }} - {{ forloop.counter }}" /></a></div>
					{% endfor %}
					{% endif %}
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-5 pl-lg-4 order-1 order-lg-2">
            <h1 class="mb-3 display-4 font-weight-bold text-uppercase" itemprop="name">{{ product.title }}</h1>
            <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
			<div class="d-flex flex-column flex-sm-row align-items-sm-center justify-content-sm-between mb-4">
              <!--
			  <ul class="list-inline mb-2 mb-sm-0">
                <li class="list-inline-item h4 font-weight-light mb-0">{{ product.cost|quantize:"1" }}&nbsp;руб.<span itemprop="priceCurrency" style="visibility:hidden;font-size:1pt;margin:0;padding:0;width:0;height:0;line-height:0;">RUB</span></li>
                {% if product.discount > 0 %}<li class="list-inline-item text-muted font-weight-light"><del><span itemprop="price">{{ product.price|quantize:"1" }}</span>&nbsp;руб.</del></li>{% endif %}
              </ul>
			  -->

              {% get_rating for product as product_rating %}
              {% if product_rating %}
              <a  data-toggle="tab" href="#reviews_tab" role="tab" style="text-decoration: none">{% render_rating for product %}</a>
              {% endif %}

            </div>
			</div>
			{% if product.partnumber %}
			<p class="mb-4 text-muted">Код производителя: {{ product.partnumber }}</p>
			{% endif %}
			{% if product.runame or product.whatis %}
			<p class="mb-4 text-muted">{{ product.whatis }} {{ product.runame }}</p>
			{% endif %}
			<!--
			  {% if product.enabled %}
			  {% if product.instock > 1 %}
			<p class="mb-4 text-success">Есть в наличии в интернет-магазине</p>
			  {% endif %}
			  {% endif %}
			-->
              <ul class="list-inline">
			  <!--
			  {% if product.enabled %}
				{% if product.instock > 0 %}
				<li class="list-inline-item"><a href="{% url 'shop:add' product.id %}" class="btn btn-success mb-1" type="submit"> <i class="fa fa-shopping-cart mr-2"></i>Купить</a></li>
				{% else %}
				<li class="list-inline-item"><a href="{% url 'shop:add' product.id %}" class="btn btn-success mb-1" type="submit"> <i class="fa fa-shopping-cart mr-2"></i>Сообщить о поступлении</a></li>
				{% endif %}
			  {% endif %}
			  -->
             <li class="list-inline-item">
			{% if product.kind.all %}
			{% if is_compared %}
				<a class="btn btn-outline-secondary mb-1 compareProduct" data-id="{{ product.id }}" href="{% url 'compare' %}" rel="nofollow"><i class="fa fa-balance-scale mr-2"></i>Сравнить</a>
			{% else %}
				<a class="btn btn-outline-secondary mb-1 compareProduct" data-id="{{ product.id }}" data-comparison-link="{% url 'compare' %}" href="{% url 'compare_product' product.code %}" rel="nofollow"> <i class="fa fa-balance-scale mr-2"></i>Добавить в сравнение</a>
			{% endif %}	
			 </li>
			{% endif %}

                         
              </ul>
          </div>
        </div>
		<div class="row">
		<div class="col float-start">
                <div class="owl-thumbs" data-slider-id="1">
				{% if product.images %}
				<button class="owl-thumb-item detail-thumb-item mb-3" style="display:inline;"><img class="img-fluid" style="max-height:80px;" src="{{ MEDIA_URL }}{{ product.image_prefix }}.jpg" alt="{{ product.title }} - {{ forloop.counter }}" /></button>
				{% for image in product.images %}
				<button class="owl-thumb-item detail-thumb-item mb-3" style="display:inline;"><img class="img-fluid" style="max-height:80px;" src="{{ MEDIA_URL }}{{ product.image_prefix }}/{{image}}.jpg" alt="{{ product.title }} - {{ forloop.counter }}" /></button>
				{% endfor %}
				{% endif %}
                </div>
              </div>
		</div>
      </div>
    </section>
    <section class="mt-5">
      <div class="container">
	  <div class="tab-content py-4">
        <ul class="nav nav-tabs flex-column flex-sm-row" role="tablist">
		{% if product.descr %}
          <li class="nav-item"><a class="nav-link detail-nav-link active" data-toggle="tab" href="#description_tab" role="tab">Описание</a></li>
		{% endif %}
		{% if product.manuals %}
          <li class="nav-item"><a class="nav-link detail-nav-link" data-toggle="tab" href="#manuals_tab" role="tab">Инструкция</a></li>
		{% endif %}
		{% if product.complect %}
          <li class="nav-item"><a class="nav-link detail-nav-link" data-toggle="tab" href="#complect_tab" role="tab">Комплектация</a></li>
		{% endif %}
		{% if 'images/'|add:product.manufacturer.code|add:'/stitches/'|add:product.code|add:'_stitches.jpg'|file_exists or product.stitches %}
          <li class="nav-item"><a class="nav-link detail-nav-link" data-toggle="tab" href="#stitches_tab" role="tab">Строчки</a></li>
		{% endif %}
		{% if product.country %}
          <li class="nav-item"><a class="nav-link detail-nav-link" data-toggle="tab" href="#specification_tab" role="tab">Технические характеристики</a></li>
		{% endif %}
          {% if product.allow_reviews %}
          <li class="nav-item"><a class="nav-link detail-nav-link" data-toggle="tab" href="#reviews_tab" role="tab">Обзоры</a></li>
          {% endif %}
        </ul>

		{% if product.descr %}
	    <div class="tab-pane active px-3 py-4 active" id="description_tab" role="tabpanel" itemprop="description">
		<div class="container">
        {{ product.descr|rebootstrap|safe }}
{% if product.spec %}
		{{ product.spec|rebootstrap|safe }}
{% endif %}
        </div>
		</div>
		{% endif %}

		{% if product.manuals %}
	    <div class="tab-pane px-3 py-4" id="manuals_tab" role="tabpanel">
        {{ product.manuals|safe }}
        </div>
		{% endif %}
		
		{% if product.complect %}
		<div class="tab-pane px-3 py-4" id="complect_tab" role="tabpanel">
		{{ product.complect|safe }}
        </div>
		{% endif %}
		
		{% if 'images/'|add:product.manufacturer.code|add:'/stitches/'|add:product.code|add:'_stitches.jpg'|file_exists or product.stitches %}
		<div class="tab-pane px-3 py-4" id="stitches_tab" role="tabpanel">
		{% if 'images/'|add:product.manufacturer.code|add:'/stitches/'|add:product.code|add:'_stitches.jpg'|file_exists %}
		<p><img src="{{ MEDIA_URL }}/images/{{ product.manufacturer.code }}/stitches/{{ product.code }}_stitches.jpg" alt="Строчки швейной машины {{ product.title }}" class="img-responsive"></p>
		{% endif %}
		{% if product.stitches %}
		{{ product.stitches|safe }}
		{% endif %}
		</div>
		{% endif %}

		{% if product.country %}
		<div class="tab-pane px-3 py-4" id="specification_tab" role="tabpanel">		
		<dl class="product-spec">
		{% with 'km_class km_font km_needles km_prog km_rapport sw_hoopsize sw_datalink sm_software sm_shuttletype sm_stitchwidth sm_stitchlenght sm_maxi sm_stitchquantity sm_buttonhole sm_alphabet sm_dualtransporter sm_platformlenght sm_freearm sm_feedwidth sm_footheight sm_constant sm_speedcontrol sm_needleupdown sm_threader sm_autocutter sm_spool sm_presscontrol sm_power sm_light sm_organizer sm_autostop sm_ruler sm_wastebin sm_cover sm_display sm_advisor sm_memory sm_mirror sm_startstop sm_kneelift sm_diffeed sm_easythreading ov_freearm sm_needles developer_country country warranty prom_transporter_type prom_shuttle_type prom_speed prom_needle_type prom_stitch_lenght prom_foot_lift prom_fabric_type prom_oil_type weight prom_weight prom_cutting prom_threads_num prom_power prom_bhlenght prom_overstitch_lenght prom_overstitch_width prom_stitch_width prom_needle_width prom_needle_num prom_platform_type prom_button_diaouter prom_button_diainner prom_needle_height prom_stitch_type prom_autothread' as field_list %}
		{% for field in field_list.split %}
		{% if field == 'developer_country' and product.developer_country.enabled or field == 'country' and product.country.enabled or field != 'developer_country' and field != 'country' %}
		{% with field_value=product|get_field:field %}
		{% if field_value %}
		{% with field_name=product|get_field_name:field|parse_field_name %}
		<dt><span>{{ field_name.0 }}{% include '_field_help.html' %}</span></dt><dd>{{ field_value|prettify }}{{ field_name.1 }}</dd>
		{% endwith %}
		{% endif %}
		{% endwith %}
		{% endif %}
		{% endfor %}
		{% endwith %}
		</dl>
		</div>
		{% endif %}

          {% if product.allow_reviews %}
          {% get_review_count for product as review_count %}
          <div class="tab-pane" id="reviews_tab" role="tabpanel">
            <div class="row mb-5">
              <div class="col-lg-10 col-xl-9">
                {% if review_count %}
                {% render_review_list for product %}
                {% else %}
                <h3>Опубликуйте ваш отзыв</h3>
                {% endif %}

                <!--
                <div class="py-5 px-3">
                  <h5 class="text-uppercase mb-4">Leave a review</h5>
                  <form class="form" id="contact-form" method="post" action="contact.php">
                    <div class="row">
                      <div class="col-sm-6">
                        <div class="form-group">
                          <label class="form-label" for="name">Your name *</label>
                          <input class="form-control" type="text" name="name" id="name" placeholder="Enter your name" required="required">
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <div class="form-group">
                          <label class="form-label" for="rating">Your rating *</label>
                          <select class="custom-select focus-shadow-0" name="rating" id="rating">
                            <option value="5">&#9733;&#9733;&#9733;&#9733;&#9733; (5/5)</option>
                            <option value="4">&#9733;&#9733;&#9733;&#9733;&#9734; (4/5)</option>
                            <option value="3">&#9733;&#9733;&#9733;&#9734;&#9734; (3/5)</option>
                            <option value="2">&#9733;&#9733;&#9734;&#9734;&#9734; (2/5)</option>
                            <option value="1">&#9733;&#9734;&#9734;&#9734;&#9734; (1/5)</option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label" for="email">Your email *</label>
                      <input class="form-control" type="email" name="email" id="email" placeholder="Enter your  email" required="required">
                    </div>
                    <div class="form-group">
                      <label class="form-label" for="review">Review text *</label>
                      <textarea class="form-control" rows="4" name="review" id="review" placeholder="Enter your review" required="required"></textarea>
                    </div>
                    <button class="btn btn-outline-dark" type="submit">Post review</button>
                  </form>
                </div>
-->

  {% if request.user.is_authenticated %}
    {% get_review_by_user for product as user_review %}
    {% if user_review %}
      <p>Вы уже оставляли отзыв о данном товаре.
         {% if not user_review.is_public %}Если вы его не видите, он может быть отклонён или ещё проверяться модератором.{% endif %}
         Вы можете <a href="{% url 'review_product' product.code %}">изменить свой отзыв</a> в любой момент.</p>
    {% else %}
      {% if review_count %}
      <p>Вы тоже можете <a href="{% url 'review_product' product.code %}">оставить свой отзыв</a> о данном товаре.</p>
      {% else %}
      <p>Вы можете быть первым, <a href="{% url 'review_product' product.code %}">кто опубликует отзыв</a> об этом товаре.</p>
      {% endif %}
    {% endif %}
  {% else %}
    <p>Отзывы о товаре могут оставлять только <a href="{% url 'shop:login' %}?next={% url 'review_product' product.code %}">зарегистрированные</a> покупатели.</p>
  {% endif %}
{% endif %}
				
				
              </div>
            </div>
          </div>

	  </div>
	  </div>

    </section>  
</div>
<!--- /product-page --->
{% endblock %}
