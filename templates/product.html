{% extends "base.html" %}
{% load staticfiles %}
{% load site %}
{% load decimals %}
{% load render_as_template %}
{% load shop_filters %}
{% load mptt_tags %}
{% load django_bootstrap_breadcrumbs %}
{% block title %}{{ product.title }}{% endblock %}
{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb "К первой странице" "/" %}
    {% breadcrumb "Каталог" "catalog" %}
    {% if product.breadcrumbs %}
    {% for node,structure in product.breadcrumbs|tree_info %}
        {% if node.is_child_node %}
            {% breadcrumb node "category" node.get_path %}
        {% endif %}
    {% endfor %}
    {% endif %}
{% endblock %}
{% block content %}
<div class="product-page">
<div itemscope itemtype="http://schema.org/Product">
<h1 class="prodname" itemprop="name">{{ product.title }}
<sup>
{% if product.ishot %}
<span class="label sw-action">Акция</span>
{% endif %}
{% if product.isnew %}
<span class="label sw-new">Новинка</span>
{% endif %}
{% if product.recomended %}
<span class="label sw-recomended">Рекомендуем</span>
{% endif %}
{% if product.utilisation %}
<span class="label sw-action">Скидка по "Утилизации"</span>
{% endif %}
</sup>
</h1>

{% if product.partnumber %}
<p>Код производителя: {{ product.partnumber }}</p>
{% endif %}
{% if product.runame or product.whatis %}
<p>{{ product.whatis }} {{ product.runame }}</p>
{% endif %}


<div class="product-image">
{% if product.image_prefix|add:'.jpg'|file_exists %}
{% if product.image_prefix|add:'.b.jpg'|file_exists %}
<div class="popup-gallery"><a href="{{ MEDIA_URL }}{{ product.image_prefix }}.b.jpg">
{% endif %}
<img id="{{ product.id }}" src="{{ MEDIA_URL }}{{ product.image_prefix }}.jpg" alt="{{ product.title }} {{ product.whatis }}" itemprop="image"  class="img-responsive"/>
{% if product.image_prefix|add:'.b.jpg'|file_exists %}
</a></div>
{% endif %}
{% endif %}
</div>

<div class="panel panel-default product-buyblock">
<div class="panel-body product-buyblock-body">
{% if product.enabled %}
<div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
{% if product.discount > 0 %}
<p class="oldprice">{{ product.price|quantize:"1" }}&nbsp;руб. <a href="#dialog_discount" class="opener"><img src="{% static 'i/icons/more_icon.png' %}"></a></p>
<div id="dialog_discount" class="mfp-hide white-popup-block">
<h4>Скидка!</h4>
<p>Базовая цена в магазинах &laquo;Швейный Мир&raquo; без учета скидок <b>{{ product.price|quantize:"1" }}&nbsp;руб.</b></p>
<p>Скидка при покупке в интернет-магазине составляет <b>{{ product.discount }}&nbsp;руб.</b></p>
</div>
{% endif %}
<p class="price"><span itemprop="price">{{ product.cost|quantize:"1" }}</span>&nbsp;руб.

{% if product.instock > 0 %}
<a href="{% url 'shop:add' product.id %}" class="addProduct btn btn-success sw-addProduct-sm" role="button" id="p_{{ product.id }}">Купить</a>
{% else %}
<a href="{% url 'shop:add' product.id %}" class="addProduct btn btn-success sw-addProduct-sm" role="button" id="p_{{ product.id }}">Сообщить о поступлении</a>
{% endif %}

<span itemprop="priceCurrency" style="visibility:hidden;font-size:1pt;margin:0;padding:0;width:0;height:0;line-height:0;">RUB</span>
{% if product.deshevle == true %}
<a href="{% url 'django.contrib.flatpages.views.flatpage' url='dialog/deshevle/' %}" class="opener-ajax deshevle">Нашли&nbsp;дешевле?</a>
{% endif %}
</p>
{% if product.available %}
<p><span class="product-nal-caption">Наличие:</span>
{% if product.instock > 1 %}
<span class="product-nal-true">Есть</span>
{% endif %}
{% if product.instock == 1 %}
<span class="product-nal-true">Мало</span>
{% endif %}
{% if product.instock < 1 %}
<span class="product-nal-false">Нет</span>
{% endif %}
</p>
{% endif %}
{% if product.state %}
<p>{{ product.state }}</p>
{% endif %}
{% if sales_notes %}
<p class="product-salesnotes">{{ sales_notes }}</p>
{% endif %}

{% if product.utilisation %}
<p class="product-salesnotes">Участник акции <a href="/actions/utilisation.html">"Утилизация"</a>! Скидка по акции <span class="price">{{ maxdiscount }}%</span>!</p>
{% endif %}
{% if product.internetonly and 1 > 2 %}
<p>Этот товар продается только в интернет-магазине. <a href="#dialog_internetonly" class="opener"><img src="{% static 'i/icons/more_icon.png' %}"></a></p>
<div id="dialog_internetonly" class="mfp-hide white-popup-block">
<h4>Этот товар продается только в интернет-магазине!</h4>
<p>Этот товар мы можем доставить курьером или транспортной компанией,<br>
а также его можно получить в нашем московском магазине на &laquo;Пролетарке&raquo;,<br>
 по адресу: Волгоградский проспект, д.10 стр.2.<br>
 В других наших магазинах этот товар купить по цене интернет-магазина нельзя.</p>
</div><!-- /#dialog_internetonly -->
{% endif %}

{% if product.warranty and product.price > 0 and not product.state and 1 > 2 %}
<p>Легко вернуть в случае неисправности.
<a href="{% url 'django.contrib.flatpages.views.flatpage' url='dialog/back/' %}" class="opener-ajax"><img src="{% static 'i/icons/more_icon.png' %}"></a></p>
{% endif %}

{% if 1 > 2 %}
<!-- %LOOP REVERSE LoopAssociatedProducts(products,@@id@@,gift) IN prod ORDER price -->
<!-- %IF FIRSTLOOPENTRY prod -->
<p class="product-gift">Покупая @@name@@ в интернет-магазине, Вы получите подарок:</p>
<div class="text-center">
<!-- %END IF -->
<!-- %IF EXPRESSION @@prod.enabled@@ > 0 -->
<!--#include virtual="/products/@@prod.code@@_inc.html" -->
<!-- %END IF -->
<!-- %IF LASTLOOPENTRY prod -->
</div>
<!-- %END IF -->
<!-- %END LOOP -->
{% endif %}

</div>
{% else %}
<span class="product-nal-false">Товар снят с продажи</span>
{% endif %}{# enabled #}
</div>
</div>

{% if product.images %}
<div class="popup-gallery">
{% for image in product.images %}
<a href="{{ MEDIA_URL }}{{ product.image_prefix }}/{{image}}.jpg"><img src="{{ MEDIA_URL }}{{ product.image_prefix }}/{{image}}.s.jpg" alt="{{ product.title }} - Фото №{{ forloop.counter }}" border="0" /></a>
{% endfor %}
</div>
{% endif %}

{% if constituents %}
<h2>Состав комплекта:</h2>
<table style="margin-bottom: 10pt">
{% for item in constituents %}
{% with item.constituent as product %}
<tr><td>{% if product.image_prefix|add:'.s.jpg'|file_exists %}
<img src="{{ MEDIA_URL }}{{ product.image_prefix }}.s.jpg" alt="{{ product.title }} {{ product.whatis }}" />
{% endif %}</td>
<td style="padding-left: 6pt">
<h3 class="sw-p-l-name-h"><a href="{% url 'product' product.code %}">{{ product.title }}</a>{% if item.quantity > 1 %} ({{ item.quantity }} шт.){% endif %}</h3>
<div class="sw-p-l-brif">
{{ product.shortdescr|safe }}
</div>
</td></tr>
<script>
gtm_products.push({'name':'{{ product.title }}','id':'{{ product.id }}','price':'{{ product.price }}','brand':'{{ product.manufacturer.code }}','list':'Состав комплекта','position':{{ forloop.counter }}});
</script>
{% endwith %}
{% endfor %}
</table>
{% endif %}

{% if product.descr %}
<p itemprop="description">{{ product.descr|safe }}</p>
{% endif %}
{% if product.spec %}
<p>{{ product.spec|safe }}</p>
{% endif %}

{% if product.manuals %}
<h2>Инструкции для {{ product.title }}:</h2>
{{ product.manuals|safe }}
{% endif %}

{% if product.warranty %}
<h2>Характеристики {{ product.title }}:</h2>
{% endif %}
<dl class="product-spec">
{% if product.fabric_verylite %}
<dt><span>Диапазон прошиваемых материалов <a class="opener-html" href="/blog/H/"><img src="{% static 'i/icons/more_icon.png' %}"></a></span></dt><dd>Очень легкие – {{ product.fabric_verylite }}<br>Легкие – {{ product.fabric_lite }}<br>Средние и умеренно тяжелые – {{ product.fabric_medium }}<br>Тяжелые – {{ product.fabric_hard }}<br>Трикотаж – {{ product.fabric_stretch }}</dd>
{% endif %}
{% with 'km_class km_font km_needles km_prog km_rapport sw_hoopsize sw_datalink sm_software sm_shuttletype sm_stitchwidth sm_stitchlenght sm_maxi sm_stitchquantity sm_buttonhole sm_alphabet sm_dualtransporter sm_platformlenght sm_freearm sm_feedwidth sm_footheight sm_constant sm_speedcontrol sm_needleupdown sm_threader sm_autocutter sm_spool sm_presscontrol sm_power sm_light sm_organizer sm_autostop sm_ruler sm_wastebin sm_cover sm_display sm_advisor sm_memory sm_mirror sm_startstop sm_kneelift sm_diffeed sm_easythreading ov_freearm sm_needles developer_country country warranty prom_transporter_type prom_shuttle_type prom_speed prom_needle_type prom_stitch_lenght prom_foot_lift prom_fabric_type prom_oil_type weight prom_weight prom_cutting prom_threads_num prom_power prom_bhlenght prom_overstitch_lenght prom_overstitch_width prom_stitch_width prom_needle_width prom_needle_num prom_platform_type prom_button_diaouter prom_button_diainner prom_needle_height prom_stitch_type prom_autothread' as field_list %}
{% for field in field_list.split %}
{% if field == 'developer_country' and product.developer_country.enabled or field == 'country' and product.country.enabled or field != 'developer_country' and field != 'country' %}
{% with field_value=product|get_field:field %}
{% if field_value %}
{% with field_name=product|get_field_name:field|parse_field_name %}
<dt><span>{{ field_name.0 }}{% include '_field_help.html' %}</span></dt><dd>{{ field_value|prettify }}{{ field_name.1 }}</dd>
{% endwith %}
{% endif %}
{% endwith %}
{% endif %}
{% endfor %}
{% endwith %}
</dl>

{% if 'images/'|add:product.manufacturer.code|add:'/stitches/'|add:product.code|add:'_stitches.jpg'|file_exists or product.stitches %}
<h2>Строчки {{ product.title }}:</h2>
{% if 'images/'|add:product.manufacturer.code|add:'/stitches/'|add:product.code|add:'_stitches.jpg'|file_exists %}
<p><img src="{{ MEDIA_URL }}/images/{{ product.manufacturer.code }}/stitches/{{ product.code }}_stitches.jpg" alt="Строчки швейной машины {{ product.title }}" class="img-responsive"></p>
{% endif %}
{% if product.stitches %}
{{ product.stitches|safe }}
{% endif %}
{% endif %}


{% if product.complect %}
<h2>Комплектация</h2>
<p>{{ product.complect|safe }}</p>
{% endif %}

</div>

</div> <!--- /product-page --->
{% endblock %}
