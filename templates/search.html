{% extends "page_overlapped.html" %}
{% load django_bootstrap_breadcrumbs %}
{% load site %}
{% load rupluralize %}
{% block title %}Поиск товаров{% endblock %}
{% block content_title %}Поиск товаров{% endblock %}
{% block body_header %}
{% with hide_search_form=True %}
{{ block.super }}
{% endwith %}
{% endblock %}
{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb "Поиск" "" %}
{% endblock %}
{% block content %}
    <!-- Page Content-->
    <div class="container pb-5 mb-2 mb-md-4">
      <div class="row">
        <!-- Sidebar-->
        <aside class="col-lg-4 pt-4 pt-lg-0">
          <!-- Sidebar--><a class="cz-sidebar-toggler" href="#shop-sidebar" data-toggle="sidebar"><i class="czi-menu"></i>
            <div class="font-size-xs mt-n1">Панель</div></a>
          <div class="cz-sidebar rounded-lg box-shadow-lg" id="shop-sidebar">
            <div class="cz-sidebar-header box-shadow-sm">
              <button class="close ml-auto" type="button" data-dismiss="sidebar" aria-label="Закрыть"><span class="d-inline-block font-size-xs font-weight-normal align-middle">Закрыть панель</span><span class="d-inline-block align-middle ml-2" aria-hidden="true">&times;</span></button>
            </div>
            <div class="cz-sidebar-body" data-simplebar data-simplebar-auto-hide="true">
              <form method="get" action="{% url 'search' %}" id="sw-search-form">
                <div class="widget mb-4 pb-4 border-bottom">
                  <input class="form-control font-weight-bold" name="text" type="text" value="{{ search_text }}" autocomplete="off">
                </div>
                {% if product_filter %}
                {% load widget_tweaks %}
                {{ product_filter.form.non_field_errors }}

                {% for hidden_field in product_filter.form.hidden_fields %}
                  {{ hidden_field.errors }}
                  {{ hidden_field }}
                {% endfor %}

                {% for field in product_filter.form.visible_fields %}
                {% get_class_name field.field as class %}
                {% if not class == 'MultipleChoiceField' or not field.field.choices|length < 2 %}{# do not show filters with only one choice #}
                {% with field_name=field.label|parse_field_name %}
                <div class="widget mb-4 pb-4 border-bottom">
                  <label class="d-block widget-title" for="{{ field.id_for_label }}">{{ field_name.0 }}</label>
                  {# field.errors #}
                  {# field is BoundField, field.field is field itself #}
                  {# if class == 'RangeField' or class == 'DecimalField' #}
                  {# render_field field class="slider_input ajaxclick" size="2" autocomplete="off" #}
                  {# else #}
                  {% render_field field class="ajaxclick" %}
                  {# endif #}
                  {% if field.name != 'price' %}
                  {% if field_name.1 %}<label>{{ field_name.1 }}</label>{% endif %}{{ field.help_text }}
                  {% endif %}
                </div>
                {% endwith %}
                {% endif %}
                {% endfor %}
                {% endif %}
                <button class="btn btn-primary btn-block" type="submit">Искать</button>
              </form>
            </div>
          </div>
        </aside>
        <!-- Content  -->
        <section class="col-lg-8">
          <!-- Toolbar-->
          <div class="d-flex justify-content-center justify-content-sm-between align-items-center pt-lg-2 pb-4 pb-sm-5 mt-n2 mt-lg-0">
            <div class="d-flex flex-wrap">
              <div class="form-inline flex-nowrap mr-3 mr-sm-4 pb-3">
                <span class="font-size-sm text-light opacity-75 text-nowrap ml-2 d-none d-md-block">{{ products.paginator.count|rupluralize:"Найден,Найдено,Найдено" }} {{ products.paginator.count }} {{ products.paginator.count|rupluralize:"товар,товара,товаров" }}</span>
              </div>
            </div>
            {% if products.has_other_pages %}
            <div class="d-flex pb-3">{% if products.has_previous %}<a class="nav-link-style nav-link-light mr-3" href="?{% query_transform request page=products.previous_page_number %}"><i class="czi-arrow-left"></i></a>{% endif %}<span class="font-size-md text-light">{{ products.number }} / {{ products.paginator.num_pages }}</span>{% if products.has_next %}<a class="nav-link-style nav-link-light ml-3" href="?{% query_transform request page=products.next_page_number %}"><i class="czi-arrow-right"></i></a>{% endif %}</div>
            {% endif %}
            <div class="d-none d-sm-flex pb-3"><a class="btn btn-icon nav-link-style bg-light text-dark disabled opacity-100 mr-2" href="#"><i class="czi-view-grid"></i></a><a class="btn btn-icon nav-link-style nav-link-light" href="shop-list-ls.html"><i class="czi-view-list"></i></a></div>
          </div>
          <!-- Products grid-->
          <div class="row mx-n2">
            {% for product in products %}
            <!-- Product-->
            <div class="col-md-4 col-sm-6 px-2 mb-4">
              {% include "_product_info.html" %}
              <hr class="d-sm-none">
            </div>
            {% endfor %}
          </div>
          {% if products.has_other_pages %}
          <hr class="my-3">
          <!-- Pagination-->
          <nav class="d-flex justify-content-between pt-2" aria-label="Переключение страниц">
            <ul class="pagination">
              {% if products.has_previous %}
              <li class="page-item"><a class="page-link" href="?{% query_transform request page=products.previous_page_number %}"><i class="czi-arrow-left mr-2"></i>Пред<span class="d-none d-sm-inline d-md-none d-xl-inline">ыдущая</span></a></li>
              {% endif %}
            </ul>
            <ul class="pagination">
              {% for page in products.paginator.page_range %}
              {% if page == products.number %}
              <li class="page-item d-md-none"><span class="page-link page-link-static">{{ products.number }} / {{ products.paginator.num_pages }}</span></li>
              <li class="page-item active d-none d-md-block" aria-current="page"><span class="page-link">{{ products.number }}<span class="sr-only">(текущая)</span></span></li>
              {% elif page >= min_page and page <= max_page or page == 1 or page == products.paginator.num_pages %}
              {% if max_page < products.paginator.num_pages and page == products.paginator.num_pages %}
              <li class="page-item d-none d-md-block">&hellip;</li>
              {% endif %}
              <li class="page-item d-none d-md-block"><a class="page-link" href="?{% query_transform request page=page %}">{{ page }}</a></li>
              {% if min_page > 1 and page == 1 %}
              <li class="page-item d-none d-md-block">&hellip;</li>
              {% endif %}
              {% endif %}
              {% endfor %}
            </ul>
            <ul class="pagination">
              {% if products.has_next %}
              <li class="page-item"><a class="page-link" href="?{% query_transform request page=products.next_page_number %}">След<span class="d-none d-sm-inline d-md-none d-xl-inline">ующая</span><i class="czi-arrow-right ml-2"></i></a></li>
              {% endif %}
            </ul>
          </nav>
          {% endif %}
        </section>
      </div>
    </div>
{% endblock %}
