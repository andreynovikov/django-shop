{% extends "two_factor/_base_focus.html" %}
{% load i18n %}
{% load two_factor_tags %}

{% block extra_media %}
  {{ form.media }}
{% endblock %}

{% block content %}
  <div id="content-main">
  {% if user.is_authenticated %}
  {% if user.is_staff %}
    <script>
      location = "{% url 'two_factor:profile' %}";
    </script>
  {% else %}
  <p class="errornote">
    {{ user.is_staff }}
    Вы вошли в систему как {{ user }}, однако у вас недостаточно прав для просмотра данной страницы.
    Возможно, вы хотели бы войти в систему, используя другую учётную запись?
  </p>
  {% endif %}
  {% endif %}

  {% if wizard.steps.current == 'token' %}
    <p>{{ device|as_verbose_action }}</p>
  {% elif wizard.steps.current == 'backup' %}
    <p>{% blocktrans trimmed %}Use this form for entering backup tokens for logging in.
      These tokens have been generated for you to print and keep safe. Please
      enter one of these backup tokens to login to your account.{% endblocktrans %}</p>
  {% endif %}

  <form action="" method="post">
    {% block main_form_content %}
    {% csrf_token %}
    {% include "two_factor/_wizard_forms.html" %}

    {# hidden submit button to enable [enter] key #}
    <input type="submit" value="" hidden />

    {% if other_devices %}
      <p>Или используйте один из других методов аутентификации:</p>
      <p>
        {% for other in other_devices %}
        <button name="challenge_device" value="{{ other.persistent_id }}"
                class="button" type="submit">
          {{ other|as_action }}
        </button>
      {% endfor %}</p>
    {% endif %}

    {% include "two_factor/_wizard_actions.html" %}
    {% endblock %}
  </form>

  {% block 'backup_tokens' %}
    {% if backup_tokens %}
       <hr>
       <div class="backup_tokens_form">
       <form action="" method="post">
           {% csrf_token %}
            <p>В крайнем случае вы можете использовать резервный токен:</p>
            <p>
                <button name="wizard_goto_step" type="submit" value="backup"
                    class="button">{% trans "Use Backup Token" %}</button>
            </p>
       </form>
       </div>
    {% endif %}
  {% endblock %}
  </div>
{% endblock %}
