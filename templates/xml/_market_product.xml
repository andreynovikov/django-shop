{% load static %}
{% load site %}
{% load decimals %}
{% load l10n %}
<offer id="{{ product.id }}" type="vendor.model">
    <url>{% site_url_prefix %}{% url 'product' product.code %}?utm_source={{ utm_source }}&amp;utm_term={{ product.id }}</url>
    {% if product.integration_price > 0 %}
    <price>{{ product.integration_price|quantize:"1" }}</price>
    {% else %}
    <price>{{ product.cost|quantize:"1" }}</price>
    {% endif %}
    <currencyId>RUR</currencyId>
    {% if stock is not None %}
    <count>{% if stock > 20 %}20{% else %}{{ stock|quantize:"1" }}{% endif %}</count>
    {% endif %}
{% for top_category in product.categories.all|get_unique_mapped_list:category_map %}
    <categoryId>{{ top_category }}</categoryId>
{% endfor %}
    <name>{{ product.whatis }} {{ product.title }}</name>
{% if product.image %}
    <picture>{% site_url_prefix %}{% get_media_prefix %}{{ product.image }}</picture>
{% endif %}
    <vendor>{{ product.manufacturer.name }}</vendor>
    <model>{{ product.title }}</model>
    {% if product.whatis %}
    <typePrefix>{{ product.whatis }}</typePrefix>
    {% endif %}
    {% if product.gtin %}
    <barcode>{{ product.gtin }}</barcode>
    {% endif %}
    {% if product.partnumber %}
    <vendorCode>{{ product.partnumber }}</vendorCode>
    {% endif %}
    <description>{{ product.whatis|safe }} {{ product.yandexdescr|safe }} {{ product.descr|striptags }}</description>
    {% if product.manufacturer_warranty %}
    <manufacturer_warranty>true</manufacturer_warranty>
    {% endif %}
    <shop-sku>{{ product.article }}</shop-sku>
    <weight>{{ product.prom_weight|unlocalize }}</weight>
    <dimensions>{{ product.length|unlocalize }}/{{ product.width|unlocalize }}/{{product.height|unlocalize }}</dimensions>
</offer>
