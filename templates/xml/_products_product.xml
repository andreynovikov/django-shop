{% load site %}
<offer id="{{ product.id }}" type="vendor.model" {% if product.instock > 10 %}available="10"{% else %}available="{{ product.instock }}"{% endif %}>
    <article>{{ product.article }}</article>
    <url>https://www.sewing-world.ru/products/{{ product.code }}.html</url>
    <price>{{ product.ws_cur_price }}</price>
    <recommended_price>{{ product.cost|floatformat }}</recommended_price>
    <max_discount>{{ product.ws_max_discount }}</max_discount>
{% if product.ws_cur_code.code == 643 %}
    <currencyId>RUR</currencyId>
{% elif product.ws_cur_code.code == 978 %}
    <currencyId>EUR</currencyId>
{% else %}
    <currencyId>USD</currencyId>
{% endif %}
{% for category in product.categories.all %}
{% with top_category=category_map|get_dict_item:category.pk %}
{% if top_category %}
    <categoryId>{{ top_category }}</categoryId>
{% endif %}
{% endwith %}
{% endfor %}
    <picture>https://www.sewing-world.ru{{ MEDIA_URL }}{{ product.image_prefix }}.jpg</picture>
    <vendor>{{ product.manufacturer.name }}</vendor>
    <model>{{ product.title }}</model>
    {% if product.whatis %}
    <typePrefix>{{ product.whatis }}</typePrefix>
    {% endif %}
    {% if product.gtin %}
    <barcode>{{ product.gtin }}</barcode>
    {% endif %}
    {% if product.partnumber %}
    <vendorCode>{{ product.partnumber }}</vendorCode>
    {% endif %}
    <description>{{ product.whatis|safe }} {{ product.yandexdescr|safe }} {{ product.descr|striptags }}</description>
</offer>
